<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FindMyPG Owner - Messages</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />

  <style>
    body { background: #f5f7fb; }
    .topbar { background: #ffffff; border-bottom: 1px solid #e5e7eb; }
    .brand-dot { width: 28px; height: 28px; border-radius: 8px; background: #0ea5a4; display: flex; align-items: center; justify-content: center; color: #fff; font-weight: 700; }
    .sidebar { background: #f3f4f6; border-right: 1px solid #e5e7eb; min-height: calc(100vh - 56px); padding: 14px 10px; }
    .side-link { display: flex; align-items: center; gap: 10px; color: #374151; text-decoration: none; padding: 10px 12px; border-radius: 10px; font-size: .95rem; }
    .side-link:hover { background: #e9eefb; }
    .side-link.active { background: #e9eefb; color: #111827; font-weight: 600; }
    .side-ic { width: 18px; height: 18px; opacity: .75; display: inline-flex; align-items: center; justify-content: center; }
    .content-wrap { padding: 18px 18px 28px; }
    .page-title { font-weight: 700; font-size: 1.4rem; color: #111827; }
    .messages-container { display: flex; gap: 16px; height: calc(100vh - 200px); margin-top: 18px; }
    .conversations-list { width: 280px; background: #fff; border-radius: 14px; border: 1px solid #e5e7eb; overflow-y: auto; }
    .conversation-item { padding: 12px; border-bottom: 1px solid #eef2f7; cursor: pointer; display: flex; align-items: center; gap: 10px; text-decoration: none; color: inherit; }
    .conversation-item:hover { background: #f9fafb; }
    .conversation-item.active { background: #e9eefb; border-left: 3px solid #0ea5a4; }
    .conv-avatar { width: 40px; height: 40px; border-radius: 50%; background: #d1d5db; object-fit: cover; }
    .conv-name { font-weight: 500; font-size: .9rem; color: #111827; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .conv-preview { font-size: .8rem; color: #6b7280; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .chat-box { flex: 1; background: #fff; border-radius: 14px; border: 1px solid #e5e7eb; display: flex; flex-direction: column; }
    .chat-header { padding: 14px 16px; border-bottom: 1px solid #eef2f7; display: flex; align-items: center; background: #f9fafb; }
    .chat-header-name { font-weight: 600; font-size: .95rem; color: #111827; }
    .chat-header-status { font-size: .8rem; color: #6b7280; }
    .messages-area { flex: 1; overflow-y: auto; padding: 16px; background: #f9fafb; }
    .message { margin-bottom: 12px; display: flex; align-items: flex-end; gap: 8px; }
    .message.owner { justify-content: flex-end; }
    .message-bubble { max-width: 70%; padding: 10px 14px; border-radius: 12px; font-size: .9rem; line-height: 1.4; }
    .message.owner .message-bubble { background: #0ea5a4; color: #fff; }
    .message.tenant .message-bubble { background: #fff; color: #111827; border: 1px solid #e5e7eb; }
    .chat-input-area { padding: 14px; border-top: 1px solid #eef2f7; background: #fff; display: flex; gap: 8px; }
    .chat-input-area input { flex: 1; border-radius: 999px; border: 1px solid #d1d5db; padding: 10px 14px; font-size: .9rem; }
    .chat-input-area button { width: 40px; height: 40px; border-radius: 50%; background: #0ea5a4; color: #fff; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    .empty-chat { display: flex; align-items: center; justify-content: center; height: 100%; color: #9ca3af; flex-direction: column; gap: 12px; }
    .muted { color: #6b7280; }
    .footer { color: #9ca3af; font-size: .85rem; padding: 18px; border-top: 1px solid #e5e7eb; background: #fff; }
  </style>
</head>

<body>
  <nav class="navbar topbar navbar-expand-lg px-3" style="height:56px;">
    <div class="d-flex align-items-center gap-2">
      <div class="brand-dot">üè†</div>
      <span class="fw-semibold" style="color:#0f766e;">FindMyPG Owner</span>
    </div>

    <div class="ms-auto d-flex align-items-center gap-3">
      <% if (typeof owner !=="undefined" && owner) { %>
        <span class="small text-secondary d-none d-md-inline">Hi, <%= owner.name %></span>
      <% } %>

      <div class="rounded-circle bg-light border" style="width:34px;height:34px; overflow:hidden;">
        <% if (typeof owner !=="undefined" && owner && owner.avatar_url) { %>
          <img src="<%= owner.avatar_url %>" alt="avatar" style="width:100%;height:100%;object-fit:cover;">
        <% } %>
      </div>
    </div>
  </nav>

  <div class="container-fluid">
    <div class="row g-0">
      <aside class="col-12 col-md-3 col-lg-2 sidebar">
        <a class="side-link" href="/owner">
          <span class="side-ic">‚ñ¶</span> My PGs
        </a>
        <a class="side-link" href="/owner/pg/new">
          <span class="side-ic">Ôºã</span> Add New PG
        </a>
        <a class="side-link" href="/owner/bookings">
          <span class="side-ic">üóì</span> Bookings
        </a>
        <a class="side-link active" href="/owner/messages">
          <span class="side-ic">üí¨</span> Messages
        </a>
        <a class="side-link" href="/owner/payouts">
          <span class="side-ic">‚Çπ</span> Payouts
        </a>
        <a class="side-link" href="/owner/settings">
          <span class="side-ic"><i class="bi bi-gear"></i></span> Settings
        </a>

        <form action="/logout" method="POST" class="mt-3 px-2">
          <button class="btn btn-outline-secondary w-100 btn-sm" type="submit">Logout</button>
        </form>
      </aside>

      <main class="col-12 col-md-9 col-lg-10 content-wrap">
        <div class="page-title mb-4">Messages</div>

        <div class="messages-container">
          <div class="conversations-list">
            <% if (!conversations || conversations.length === 0) { %>
              <div class="p-3 text-center muted">No conversations yet.</div>
            <% } else { %>
              <% conversations.forEach((conv, idx) => { %>
                <a href="#" class="conversation-item <%= (selectedIdx === idx || (!selectedIdx && idx === 0)) ? 'active' : '' %>" onclick="selectConversation(event, <%= idx %>)">
                  <img src="<%= conv.avatar || 'https://via.placeholder.com/40' %>" alt="avatar" class="conv-avatar">
                  <div style="flex: 1; min-width: 0;">
                    <div class="conv-name"><%= conv.name %></div>
                    <div class="conv-preview"><%= conv.lastMessage || 'No messages' %></div>
                  </div>
                </a>
              <% }) %>
            <% } %>
          </div>

          <div class="chat-box">
            <% if (!currentChat) { %>
              <div class="empty-chat">
                <div style="font-size: 2rem;">üí¨</div>
                <p>Select a conversation to start messaging</p>
              </div>
            <% } else { %>
              <div class="chat-header">
                <img src="<%= currentChat.avatar || 'https://via.placeholder.com/32' %>" alt="avatar" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover; margin-right: 10px;">
                <div>
                  <div class="chat-header-name"><%= currentChat.name %></div>
                  <div class="chat-header-status">Online</div>
                </div>
              </div>

              <div class="messages-area">
                <% (currentChat.messages || []).forEach(msg => { %>
                  <div class="message <%= msg.isOwner ? 'owner' : 'tenant' %>">
                    <div class="message-bubble"><%= msg.text %></div>
                  </div>
                <% }) %>
              </div>

              <div class="chat-input-area">
                <input type="text" placeholder="Type your message..." id="messageInput">
                <button onclick="sendMessage()">‚û§</button>
              </div>
            <% } %>
          </div>
        </div>
      </main>
    </div>
  </div>

  <div class="footer text-center">
    ¬© <%= new Date().getFullYear() %> FindMyPG Owner. All rights reserved.
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function selectConversation(e, idx) {
      e.preventDefault();
    }
    function sendMessage() {
      const input = document.getElementById("messageInput");
      if (!input.value.trim()) return;
      input.value = "";
    }
  </script>
</body>

</html>
